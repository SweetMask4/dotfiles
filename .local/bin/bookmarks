#!/bin/sh

dir="$HOME/.local/share/snippets"
snippet="$dir/snippets"

show_bookmarks(){
    [ ! -d "$dir" ] && mkdir "$dir"
    [ ! -f "$snippet" ] && touch "$snippet"

    show_bookmarks="$(cat "$snippet")"
    [ -z "$show_bookmarks" ] && exit 1
    choice=$(printf '%s' "$show_bookmarks" | dmenu -i -g 1 -p  "Librewolf open: " )
    [ -z "$choice" ] && exit 1

    setsid -f "$BROWSER" "$choice" >/dev/null 2>&1 &
}

add_bookmarks(){
    bookmarks=$(xclip -o)

    if echo "$bookmarks" | grep -q "https*://\S\+\.[A-Za-z]\+\S*" ; then
        if grep -q "^$bookmarks$" "$snippet";
        then
            notify-send "already has this bookmarks"
        else
            notify-send "added bookmarks"
            echo "$bookmarks" >> "$snippet"
        fi
    else
        notify-send "That doesn't look like a full URL." && exit 1
    fi
}

main() {
    case "$1" in
        show) show_bookmarks ;;
        add) add_bookmarks ;;
        * ) exit 0 ;;
    esac
}
main "$1"
