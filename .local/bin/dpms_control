#!/usr/bin/env sh

while true; do
    dpms_state=$(xset q | grep "DPMS is")
    printf "%s\n" "$dpms_state"
    if pacmd list-sink-inputs | grep "qutebrowser" > /dev/null; then
        printf "Sound from qutebrowser detected\n"
        if [ "$dpms_state" = "  DPMS is Enabled" ]; then
            printf "Disabling screensaver and DPMS\n"
            xset s off
            xset -dpms
        fi
    else
        printf "No sound detected from qutebrowser\n"
        if [ "$dpms_state" = "  DPMS is Disabled" ]; then
            printf "Enabling screensaver and DPMS\n"
            xset s on
            xset +dpms
        fi
    fi
    printf "Gonna sleep now...\n"
    sleep 30
    printf "End of while loop\n\n"
done
